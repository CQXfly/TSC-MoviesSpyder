makeInstaller=function(n){"use strict";var e=(n=n||{}).extensions||[".js",".json"],t=n.onInstall,r=n.wrapRequire,o=n.override,u=n.fallback,i=n.mainFields||(n.browser?["browser","main"]:["main"]),s={}.hasOwnProperty;function c(n,e){return y(n)&&w(e)&&s.call(n,e)}var f,l,a={},d=new I("/",new I("/..")),p=j(d);function v(n,e){return y(n)&&(!function n(e,t,r){Array.isArray(t)?(t.forEach(function(n){w(n)?e.deps[n]=e.module.id:b(n)?t=n:y(n)&&(e.stub=e.stub||{},A(n,function(n,t){e.stub[t]=n}))}),b(t)||(t=null)):b(t)||w(t)||y(t)||(t=null);t&&(e.contents=e.contents||(y(t)?{}:t),y(t)&&g(e)&&A(t,function(t,o){if(".."===o)u=e.parent;else{var u=m(e.contents,o);u||((u=e.contents[o]=new I(e.module.id.replace(/\/*$/,"/")+o,e)).options=r)}n(u,t,r)}))}(d,n,e),b(t)&&t(p)),p}function h(n){this.id=n,this.children=[],this.childrenById={}}function m(n,e){return c(n,e)&&n[e]}function y(n){return null!==n&&"object"==typeof n}function b(n){return"function"==typeof n}function w(n){return"string"==typeof n}function x(n){return new Error("Cannot find module '"+n+"'")}function j(n){function e(e){var t=P(n,e);if(t)return k(t,n.module);var r=x(e);if(b(u))return u(e,n.module.id,r);throw r}return b(r)&&(e=r(e,n.module)),e.extensions=q(n).slice(0),e.resolve=function(e){var t=P(n,e);if(t)return t.module.id;var r=x(e);if(u&&b(u.resolve))return u.resolve(e,n.module.id,r);throw r},e}function I(n,e){var t=this;t.parent=e=e||null,t.module=new h(n),a[n]=t,t.contents=null,t.deps={}}function k(n,e){var t=n.module;if(!c(t,"exports")){var r=n.contents;if(!r){if(n.stub)return n.stub;throw x(t.id)}if(e){t.parent=e;var o=e.children;Array.isArray(o)&&o.push(t)}b(t.useNode)&&t.useNode()||r(t.require=t.require||j(n),t.exports=n.stub||{},t,n.module.id,n.parent.module.id),t.loaded=!0}var u=t.runSetters||t.runModuleSetters;return b(u)&&u.call(t),t.exports}function g(n){return n&&y(n.contents)}function A(n,e,t){Object.keys(n).forEach(function(t){e.call(this,n[t],t)},t)}function q(n){return n.options&&n.options.extensions||e}function B(n,e,t){for(;n&&!g(n);)n=n.parent;if(!n||!e||"."===e)return n;if(".."===e)return n.parent;var r=m(n.contents,e);if(t&&(!r||g(r)))for(var o=0;o<t.length;++o){var u=m(n.contents,e+t[o]);if(u&&!g(u))return u}return r}function E(n,e,t){var r=e.split("/");return r.every(function(e,o){return n=o<r.length-1?B(n,e):B(n,e,t)}),n}function O(n,e){var t=e&&e.module;n&&t&&(n.childrenById[t.id]=t)}function P(n,e,t,r){t=t||n.module;var u=q(n);for(n="/"===e.charAt(0)?E(d,e,u):"."===e.charAt(0)?E(n,e,u):function(n,e,t){b(o)&&(e=o(e,n.module.id));if(w(e)){for(var r;n&&!r;n=n.parent)r=g(n)&&E(n,"node_modules/"+e,t);return r}}(n,e,u);g(n);){if((r=r||[]).indexOf(n)<0){r.push(n);var s,c=B(n,"package.json"),f=c&&k(c,t);if(f&&i.some(function(n){return w(s=f[n])})){var l=E(n,s,u)||P(n,s,t,r);if(l){n=l,O(t,c);continue}}}n=B(n,"index.js")}return n&&w(n.contents)&&(n=P(n,n.contents,t,r)),O(t,n),n}return v.fetch=function(n){throw new Error("fetch not implemented")},h.prototype.resolve=function(n){return this.require.resolve(n)},h.prototype.prefetch=function(n){var e=this,t=(m(a,e.id),f=f||Promise.resolve());function r(n){var e,t=m(a,n.id);(e=t)&&null===e.contents&&!t.pending&&(t.pending=!0,(l=l||{})[n.id]={module:t.module,deps:Object.keys(t.deps),options:t.options,stub:t.stub},A(t.deps,function(n,e){P(t,e)}),A(n.childrenById,r))}return f=new Promise(function(t){var o=e.resolve(n);A(e.childrenById,r),t(o)}).then(function(n){var e=l;return l=null,Promise.resolve(e&&v.fetch(e)).then(function(e){function r(){return v(e),n}return t.then(r,r)})})},v.Module=h,v},"object"==typeof exports&&(exports.makeInstaller=makeInstaller);
